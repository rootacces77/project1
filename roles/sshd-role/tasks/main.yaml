---
# tasks file for sshd-role
- name: Setup Firewalld
  ansible.builtin.import_role:
    name: firewalld-role
    tasks_from: sshd.yaml

- name: Setup SeLinux
  ansible.builtin.import_role:
    name: selinux-role
    tasks_from: sshd.yaml

- name: Setup sshd config
  ansible.builtin.template:
    src: server_config.conf.j2
    dest: /etc/ssh/sshd_config.d/server_config.conf
    mode: '0640'
    owner: root
    group: root
  when: "'entry-server' not in group_names"
  notify:
    - Restart sshd
  
- name: Setup sshd config
  vars:
    sshd_tcp_forwd: "yes"
    sshd_gw_ports: "no"
  ansible.builtin.template:
    src: server_config.conf.j2
    dest: /etc/ssh/sshd_config.d/server_config.conf
    mode: '0640'
    owner: root
    group: root
  when: "'entry-server' in group_names"
  notify:
    - Restart sshd
